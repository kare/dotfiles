#!/bin/zsh

function usage() {
    echo "usage: `basename $0` [-h]Â [-u]" 1>&2
    echo "stash, update and add modules, commit and pop stash" 1>&2
    echo "-u only update modules" 1>&2
    exit 1
}

if [[ "$1" == "-h" ]]; then
  usage
fi

if [[ "$1" != "-u" ]]; then
  dotfiles stash
fi
foreach module (`ls -d ~/.vim/bundle/*`)
  echo "Updating $module"
  cd $module
  git checkout master
  git pull
  if [[ "$1" != "-u" ]]; then
    dotfiles add $module
  fi
end
if [[ "$1" != "-u" ]]; then
  cd
  dotfiles commit -s -m "Update modules"
  dotfiles stash pop
fi
